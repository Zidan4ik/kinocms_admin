<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <link rel="stylesheet" href="/vuexy/assets/vendor/css/rtl/core.css"/>
    <link rel="stylesheet" href="/vuexy/assets/vendor/css/rtl/theme-default.css"/>
    <link rel="stylesheet" href="/vuexy/assets/vendor/fonts/tabler-icons.css">
    <link rel="stylesheet" href="/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="stylesheet" href="/vuexy/assets/vendor/libs/apex-charts/apex-charts.css"/>
</head>

<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-navbar-full layout-horizontal layout-without-menu">

    <!-- Layout container -->
    <div class="layout-container">

        <!-- Navbar -->
        <div th:insert="~{blocks/navbar::navbar}"></div>
        <!--/ Navbar -->

        <!-- Layout page -->
        <div class="layout-page">

            <!-- Menu -->
            <aside th:insert="blocks/sidebar::sidebar"
                   id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme sidebar"
                   style="display: flex;flex-direction: column;height: 100%;">
            </aside>
            <!--/ Menu -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->
                <div class="container-xxl d-flex align-items-stretch flex-grow-1 p-0">
                    <div class="flex-shrink-1 flex-grow-1 container-p-x container-p-y">
                        <div style="margin-top: 50px"></div>
                        <div class="row d-flex justify-content-evenly">
                            <!-- Statistics Cities -->
                            <div class="card mt-5 col-6">
                                <div class="card-header d-flex"
                                     style="padding-bottom: 0px">
                                    <h5 class="card-title mb-0">Чисельність населення міст</h5>
                                </div>
                                <hr>
                                <div class="card-body d-flex align-items-start">
                                    <canvas id="myChart"></canvas>
                                </div>
                            </div>
                            <!-- Statistics Cities -->

                            <!-- Statistics Genders -->
                            <div class="card mt-5 col-5">
                                <div class="card-header d-flex"
                                     style="padding-bottom: 0px">
                                    <h5 class="card-title mb-0">Гендер</h5>
                                </div>
                                <hr>
                                <div class="card-body d-flex align-items-end justify-content-center">
                                    <canvas id="myChartGender"></canvas>
                                </div>
                            </div>
                            <!--/ Statistics Genders -->
                        </div>
                        <!-- Statistics -->
                        <div class="card mt-4" style="width: 96%;margin-left: 23px;">
                            <div class="card-header d-flex justify-content-between">
                                <h5 class="card-title mb-0">Кіноіндустрія</h5>
                            </div>
                            <div class="card-body d-flex align-items-end">
                                <div class="w-100">
                                    <div class="row gy-3">
                                        <div class="col-md-3 col-6">
                                            <div class="d-flex align-items-center">
                                                <div class="badge rounded bg-label-primary me-4 p-2"><i
                                                        class="ti ti-masks-theater ti-lg"></i></div>
                                                <div class="card-info">
                                                    <h5 class="mb-0" id="cinemas_"></h5>
                                                    <small>Кінотеатри</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <div class="d-flex align-items-center">
                                                <div class="badge rounded bg-label-info me-4 p-2">
                                                    <i class="ti ti-device-audio-tape ti-lg"></i>
                                                </div>
                                                <div class="card-info">
                                                    <h5 class="mb-0" id="halls_"></h5>
                                                    <small>Зали</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <div class="d-flex align-items-center">
                                                <div class="badge rounded bg-label-danger me-4 p-2"><i
                                                        class="ti ti-news ti-lg"></i></div>
                                                <div class="card-info">
                                                    <h5 class="mb-0" id="news_"></h5>
                                                    <small>Новини</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <div class="d-flex align-items-center">
                                                <div class="badge rounded bg-label-success me-4 p-2"><i
                                                        class="ti ti-discount-2 ti-lg"></i></div>
                                                <div class="card-info">
                                                    <h5 class="mb-0" id="shares_"></h5>
                                                    <small>Акції</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Statistics -->

                        <!-- Online users -->
                        <div class="card mt-4" style="width: 96%;margin-left: 23px;">
                            <div class="card-header d-flex justify-content-between">
                                <h5 class="card-title mb-0">Активність</h5>
                            </div>
                            <div class="card-body d-flex align-items-end">
                                <div class="w-100">
                                    <div class="row gy-3">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                <tr>
                                                    <th>Ролі</th>
                                                    <th>Статус</th>
                                                    <th>Кількість</th>
                                                </tr>
                                                </thead>
                                                <tbody class="table-border-bottom-0">
                                                <tr>
                                                    <td>
                                                        <i class="ti ti-user ti-md text-danger"></i>
                                                        <i class="ti ti-shield-lock ti-md text-danger me-4"></i>
                                                        <span class="fw-medium">Адміни</span>
                                                    </td>
                                                    <td>Активний</td>
                                                    <td id="onlineAdmins_"
                                                        style="padding-left: 35px;"></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <i class="ti ti-user ti-md text-danger"></i>
                                                        <i class="me-4"></i>
                                                        <span class="fw-medium" style="padding-left: 30px;">Користувачі</span>
                                                    </td>
                                                    <td>Активний</td>
                                                    <td id="onlineUsers_"
                                                        style="padding-left: 35px;"></td>
                                                </tr>
<!--                                                <tr>-->
<!--                                                    <td>-->
<!--                                                        <i class="ti ti-user ti-md text-danger me-4"></i>-->
<!--                                                        <i class="ti ti-shield-lock ti-md text-danger me-4"></i>-->
<!--                                                        <span class="fw-medium">Admins</span>-->
<!--                                                    </td>-->
<!--                                                    <td>UnActive</td>-->
<!--                                                    <td id="noOnlineAdmins_"></td>-->
<!--                                                </tr>-->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Online users -->
                    </div>
                </div>
                <!--/ Content -->
            </div>
            <!--/ Content wrapper -->
        </div>
        <!--/ Layout page -->
    </div>
    <!--/ Layout container -->
</div>
<!--/ Layout wrapper -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/vuexy/assets/vendor/js/helpers.js"></script>
<script src="/vuexy/assets/js/config.js"></script>
<script src="/vuexy/dist/js/bootstrap.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('myChart');
    const ctxGender = document.getElementById('myChartGender').getContext('2d');

    function getCities(array) {
        let citiesNames = [];
        for (let i = 0; i < array.length; i++) {
            citiesNames.push(array[i].city);
        }
        return citiesNames;
    }

    function getCountsCities(array) {
        let counts = [];
        for (let i = 0; i < array.length; i++) {
            counts.push(array[i].count);
        }
        return counts;
    }

    function printChartCities(array) {
        let names = getCities(array);
        let counts = getCountsCities(array);
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: names,
                datasets: [{
                    label: 'Кількість користувачів по містах',
                    data: counts,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function printChartGenders(amountMen, amountWomen) {
        const data = {
            labels: ['Чоловіки', 'Жінки'],
            datasets: [{
                label: 'Gender',
                data: [amountMen, amountWomen],
                backgroundColor: [
                    'rgb(54, 162, 235)',
                    'rgb(255, 99, 132)'
                ]
            }]
        };

        const config = {
            type: 'pie',
            data: data,
        };
        new Chart(ctxGender, config);

        const canvas = document.getElementById('myChartGender');
        canvas.style.width = '233px';
        canvas.style.height = '233px';
    }
</script>

<script>
    let cities = [];
    let amountMen;
    let amountWomen;

    function requestGetStatisticData() {
        const request = new XMLHttpRequest();
        request.open("GET", `/admin/statistic-data`);
        request.setRequestHeader("Content-type", "application/json; charset=utf-8");
        request.send();
        request.addEventListener("load", function () {
                if (request.status === 200) {
                    let data = JSON.parse(request.response);
                    console.log(data);
                    cities = data.citiesDTO;
                    amountMen = data.amountMen;
                    amountWomen = data.amountWomen;
                    printChartCities(cities);
                    printChartGenders(amountMen, amountWomen);

                    document.getElementById("cinemas_").textContent = data.amountCinemas;
                    document.getElementById("halls_").textContent = data.amountHalls;
                    document.getElementById("news_").textContent = data.amountNews;
                    document.getElementById("shares_").textContent = data.amountShares;
                    document.getElementById("onlineAdmins_").textContent = data.onlineUsers;
                }
            }
        );
    }

    window.addEventListener('DOMContentLoaded', function () {
        requestGetStatisticData();
    });
</script>
</body>
</html>